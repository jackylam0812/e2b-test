# E2B 性能测试框架 - 版本说明

## 📦 软件版本

### Python 依赖(已锁定)

```
核心:
  e2b==1.1.0           ← 关键版本,兼容性验证通过
  pyyaml==6.0.2

可选(云存储测试):
  boto3==1.35.0
  botocore==1.35.0
  google-cloud-storage==2.18.2
  azure-storage-blob==12.23.1
```

### 服务端版本

```
E2B Envd: 0.2.0      ← 限制了 SDK 版本选择
```

### 系统工具

```
宿主机测试需要:
  sysbench     (CPU/内存性能测试)
  fio          (磁盘 I/O 测试)
  iperf3       (网络带宽测试,可选)

沙箱内测试需要:
  sysbench, fio, curl, ping, bc, jq
  (脚本会自动安装)
```

---

## 🔄 版本兼容性

### ✅ 已验证的组合

| 组件 | 版本 | 状态 |
|------|------|------|
| Python SDK | 1.1.0 | ✅ 可用 |
| Envd | 0.2.0 | ✅ 服务端 |
| Python | 3.10+ | ✅ 测试通过 |

### ⚠️  已知问题

| 组件 | 版本 | 问题 |
|------|------|------|
| Python SDK | 2.x | ❌ 与 envd 0.2.0 不兼容 |
| Python SDK | 1.x | ⚠️  无法执行沙箱内命令 |
| Node CLI | 1.4.1 | ⚠️  需要 Node.js >= 18 |

### 功能可用性

| 功能 | SDK 1.1.0 | 说明 |
|------|-----------|------|
| Sandbox 创建 | ✅ | 使用 `Sandbox(template)` |
| 启动延迟测试 | ✅ | 完全可用 |
| 沙箱内命令执行 | ❌ | "Invalid host" 错误 |
| 宿主机测试 | ✅ | 不依赖 SDK |
| 云存储测试 | ✅ | 不依赖 SDK |

---

## 📖 版本历史

### v2.0 (2025-11-24) - 最终版本

**重大变更**:
- 🏗️ 重构为三层架构 (Host/Client/Sandbox)
- 🔒 锁定 e2b SDK 为 1.1.0
- 📝 完善所有文档
- 🧹 清理临时诊断脚本

**测试覆盖**:
- ✅ 宿主机性能 (CPU/磁盘/内存)
- ✅ 启动延迟 (冷/热启动)
- ✅ 云存储性能
- 🔧 沙箱内性能 (需手动测试)

**文档**:
- 最终使用指南.md (新增)
- 版本说明.md (新增)
- 项目结构说明.md (更新)
- 测试执行指南.md (更新)

### v1.0 (初始版本)

- 🎉 基础测试框架
- 📊 性能指标定义
- 🧪 自动化测试脚本

---

## 🔧 升级建议

### 如果 envd 升级到新版本

1. **测试新的 SDK 版本**:
   ```bash
   # 尝试 SDK 2.x
   pip3 install 'e2b==2.7.0'
   python3 tests/client/run_all_tests.py
   ```

2. **验证命令执行**:
   ```bash
   python3 -c "
   from e2b import Sandbox
   s = Sandbox.create('template')
   result = s.commands.run('echo hello')
   print('✓ 可用' if result.exit_code == 0 else '✗ 失败')
   s.kill()
   "
   ```

3. **更新 requirements.txt**:
   ```
   e2b==2.7.0  # 或验证通过的版本
   ```

4. **重新测试所有功能**

---

## 📝 版本选择指南

### 何时使用 e2b 1.1.0

- ✅ 服务端 envd 为 0.2.0
- ✅ 需要稳定的启动延迟测试
- ✅ 只需要宿主机性能对比

### 何时升级 SDK

- 服务端 envd 已升级
- 需要沙箱内自动化测试
- 需要新功能支持

---

## 🆘 故障排查

### 问题: "Sandbox has no attribute 'create'"

**原因**: SDK 版本错误
**解决**: `pip3 install e2b==1.1.0`

### 问题: "Invalid host"

**原因**: SDK 与 envd 版本不兼容
**解决**: 使用 SDK 1.1.0 + 手动测试沙箱内性能

### 问题: "缺少环境变量"

**原因**: 未加载 .e2b_env
**解决**: `source .e2b_env`

---

*当前稳定版本: e2b==1.1.0*
*测试环境: Python 3.10, envd 0.2.0*
*更新日期: 2025-11-24*
