# E2B服务基准测试记录表单

**测试日期**: ___________  
**测试人员**: ___________  
**云厂商**: ___________  
**区域**: ___________  
**实例类型**: ___________

---

## 测试环境信息

### 宿主机配置
- **vCPU**: _____ 核
- **内存**: _____ GB
- **本地存储**: _____ TB SSD
- **CPU型号**: _____________________
- **操作系统**: _____________________
- **内核版本**: _____________________

### 沙箱模板信息
- **基础镜像**: _____________________
- **模板名称**: _____________________
- **模板大小**: _____ MB
- **Python版本**: _____________________
- **Node.js版本**: _____________________

---

## 一、沙箱生命周期指标测试

### 1.1 沙箱创建性能

#### 冷启动延迟测试 (单位: ms)

| 测试次数 | 延迟值 | 备注 |
|---------|--------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |
| 6 | | |
| 7 | | |
| 8 | | |
| 9 | | |
| 10 | | |

**统计结果**:
- 最小值: _____ ms
- 最大值: _____ ms
- 平均值: _____ ms
- 中位数: _____ ms
- P50: _____ ms
- P95: _____ ms ⭐
- P99: _____ ms
- 标准差: _____ ms

---

#### 热启动延迟测试 (单位: ms)

| 测试次数 | 延迟值 | 备注 |
|---------|--------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |
| 6 | | |
| 7 | | |
| 8 | | |
| 9 | | |
| 10 | | |

**统计结果**:
- P50: _____ ms ⭐
- P95: _____ ms
- P99: _____ ms

---

#### 快照恢复延迟测试 (单位: ms)

⚠️ **此测试暂时无法进行** - 当前E2B API不支持快照恢复功能

| 测试次数 | 延迟值 | 备注 |
|---------|--------|------|
| - | N/A | 无法测试 |

**统计结果**:
- P50: N/A
- P95: N/A
- P99: N/A

---

### 1.2 沙箱运行成本

- **实例小时成本**: $_____ /小时
- **单机最大沙箱密度**: _____ 个
- **活跃资源占用比例**: _____%
- **沙箱活跃成本**: $_____ /小时/沙箱

---

## 二、模板管理指标测试

### 2.1 模板构建性能

- **模板构建时间**: _____ 秒

**分解耗时**:
- 镜像上传时间: _____ 秒
- 系统配置时间: _____ 秒
- 快照生成时间: _____ 秒

---

### 2.2 模板存储成本

- **模板大小**: _____ GB
- **存储单价**: $_____ /GB/月
- **模板数量**: _____ 个
- **模板存储成本**: $_____ /月 ⭐

---

## 三、快照机制指标测试

### 3.1 快照创建性能

- **快照创建时间**: _____ ms
- **快照大小**: _____ GB

**分解耗时**:
- 内存快照时间: _____ ms
- 磁盘快照时间: _____ ms
- 元数据保存时间: _____ ms

---

### 3.2 快照存储成本

- **快照大小**: _____ GB
- **快照数量**: _____ 个
- **快照存储成本**: $_____ /月

---

## 四、沙箱内部性能指标测试

### 4.1 沙箱CPU性能

#### 沙箱内CPU单线程性能 (单位: events/s) ⭐

| 测试次数 | 性能分数 | 备注 |
|---------|---------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均分数**: _____ events/s ⭐

---

#### 沙箱内CPU多线程性能 (单位: events/s) ⭐

| 测试次数 | 性能分数 | 备注 |
|---------|---------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均分数**: _____ events/s ⭐

---

#### 虚拟化开销计算 ⭐

- **宿主机原生CPU分数**: _____ events/s
- **沙箱内CPU分数**: _____ events/s
- **虚拟化开销**: _____% ⭐ (目标: <5%)

---

#### CPU频率稳定性测试

| 测量次数 | CPU频率(MHz) | 备注 |
|---------|-------------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |
| 6 | | |
| 7 | | |
| 8 | | |
| 9 | | |
| 10 | | |

**统计结果**:
- 平均频率: _____ MHz
- 标准差: _____ MHz
- **频率波动系数**: _____ (目标: <0.05)

---

### 4.2 沙箱内存性能

#### 沙箱内存带宽测试 (单位: MiB/s)

| 测试次数 | 内存带宽 | 备注 |
|---------|---------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均带宽**: _____ MiB/s

---

#### 沙箱内存分配延迟测试 (单位: ms)

| 测试次数 | 分配延迟 | 备注 |
|---------|---------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均延迟**: _____ ms

---

### 4.3 沙箱磁盘I/O性能

#### 沙箱随机读IOPS测试 ⭐

**队列深度 = 1**

| 测试次数 | IOPS | 备注 |
|---------|------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均IOPS (QD=1)**: _____ IOPS ⭐

**队列深度 = 4**

| 测试次数 | IOPS | 备注 |
|---------|------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均IOPS (QD=4)**: _____ IOPS

**队列深度 = 16**

| 测试次数 | IOPS | 备注 |
|---------|------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均IOPS (QD=16)**: _____ IOPS

---

#### 沙箱随机写IOPS测试

| 测试次数 | IOPS | 备注 |
|---------|------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均IOPS**: _____ IOPS

---

#### 沙箱顺序读吞吐量测试 (单位: MB/s)

| 测试次数 | 吞吐量 | 备注 |
|---------|--------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均吞吐量**: _____ MB/s

---

#### 沙箱顺序写吞吐量测试 (单位: MB/s)

| 测试次数 | 吞吐量 | 备注 |
|---------|--------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均吞吐量**: _____ MB/s

---

#### 沙箱磁盘I/O延迟测试

**从fio输出提取**:
- 平均延迟: _____ μs
- P50延迟: _____ μs
- P95延迟: _____ μs
- P99延迟: _____ μs

---

### 4.4 沙箱网络性能

#### 沙箱对外网络延迟测试 (单位: ms)

**ping 8.8.8.8 (100次)**:
- 最小延迟: _____ ms
- 平均延迟: _____ ms
- 最大延迟: _____ ms
- 标准差: _____ ms

---

#### 沙箱下载带宽测试 (单位: Mbps)

| 测试次数 | 下载带宽 | 备注 |
|---------|---------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均下载带宽**: _____ Mbps

---

#### 沙箱上传带宽测试 (单位: Mbps)

| 测试次数 | 上传带宽 | 备注 |
|---------|---------|------|
| 1 | | |
| 2 | | |
| 3 | | |
| 4 | | |
| 5 | | |

**平均上传带宽**: _____ Mbps

---

#### 沙箱网络吞吐量稳定性

- 平均带宽: _____ Mbps
- 标准差: _____ Mbps
- **带宽波动系数**: _____ (目标: <0.1)

---

### 4.5 沙箱应用场景性能

#### Python代码执行性能测试 ⭐

**pyperformance结果**:
- **几何平均分数**: _____ score ⭐
- 测试耗时: _____ 分钟

---

#### Node.js代码执行性能测试 ⭐

**benchmark结果**:
- **性能分数**: _____ score ⭐
- 测试耗时: _____ 分钟

---

#### 包管理器安装速度测试

**Python (pip install numpy pandas scikit-learn)**:

| 测试次数 | 安装耗时(s) | 备注 |
|---------|-----------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均耗时**: _____ 秒

**Node.js (npm install express react lodash)**:

| 测试次数 | 安装耗时(s) | 备注 |
|---------|-----------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均耗时**: _____ 秒

---

#### 容器内容器性能测试

**docker run --rm alpine echo "Hello"**:

| 测试次数 | 启动耗时(s) | 备注 |
|---------|-----------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均耗时**: _____ 秒

---

### 4.6 沙箱资源隔离质量

#### CPU隔离效果测试 ⭐

**测试步骤**:
1. 空闲宿主机测试沙箱CPU性能
2. 启动多个高CPU负载沙箱
3. 再次测试目标沙箱CPU性能

- **基准分数** (空闲): _____ events/s
- **负载分数** (高负载): _____ events/s
- **CPU隔离效果**: _____% ⭐ (目标: >95%)

---

#### 内存隔离效果测试

- **基准带宽** (空闲): _____ MiB/s
- **负载带宽** (高负载): _____ MiB/s
- **内存隔离效果**: _____% (目标: >95%)

---

#### 磁盘I/O隔离效果测试 ⭐

- **基准IOPS** (空闲): _____ IOPS
- **负载IOPS** (高负载): _____ IOPS
- **磁盘I/O隔离效果**: _____% ⭐ (目标: >95%)

---

## 五、宿主机性能指标测试

### 5.1 CPU性能

#### CPU单核性能测试

**sysbench cpu --threads=1**:
- **单核分数**: _____ events/s

---

#### CPU多核性能测试

**sysbench cpu --threads=N**:
- **多核分数**: _____ events/s

---

#### CPU架构与型号

- **CPU厂商**: ___________
- **CPU型号**: ___________
- **微架构**: ___________
- **基础频率**: _____ GHz
- **睿频**: _____ GHz
- **核心数**: _____ 核
- **线程数**: _____ 线程

---

### 5.2 内存性能

#### 内存带宽测试 (单位: GB/s)

**STREAM或sysbench memory**:
- 顺序读带宽: _____ GB/s
- 顺序写带宽: _____ GB/s
- 随机读带宽: _____ GB/s
- 随机写带宽: _____ GB/s

---

#### 内存延迟测试

- **内存延迟**: _____ ns

---

#### 大页内存支持 ⭐

**检查配置**:
- 是否启用: □ Yes  □ No
- 大页大小: □ 2MB  □ 1GB
- 可用大页数量: _____
- 大页内存总量: _____ GB

**性能提升测试**:
- 未启用大页性能: _____ events/s
- 启用大页性能: _____ events/s
- **大页内存性能提升**: _____% ⭐ (预期: 5-15%)

---

### 5.3 存储I/O性能

#### 本地磁盘随机读IOPS测试

**队列深度 = 1**:
- **IOPS (QD=1)**: _____ IOPS

**队列深度 = 4**:
- **IOPS (QD=4)**: _____ IOPS

**队列深度 = 16**:
- **IOPS (QD=16)**: _____ IOPS

**队列深度 = 32**:
- **IOPS (QD=32)**: _____ IOPS

---

#### 本地磁盘随机写IOPS测试

- **随机写IOPS**: _____ IOPS

---

#### 本地磁盘顺序读吞吐量测试

- **顺序读吞吐量**: _____ MB/s

---

#### 本地磁盘顺序写吞吐量测试

- **顺序写吞吐量**: _____ MB/s

---

#### 磁盘延迟测试

- 平均延迟: _____ μs
- P50延迟: _____ μs
- P95延迟: _____ μs
- P99延迟: _____ μs

---

#### FIO 综合性能测试 ⭐

**测试说明**: 使用 fio 工具进行全面的磁盘 I/O 性能测试

**顺序读测试 (seq-read)**:
- 读 IOPS: _____ IOPS
- 读带宽: _____ KB/s
- 读延迟: _____ ns

**顺序写测试 (seq-write)**:
- 写 IOPS: _____ IOPS
- 写带宽: _____ KB/s
- 写延迟: _____ ns

**随机读测试 (rand-read-4k)**:
- 读 IOPS: _____ IOPS
- 读带宽: _____ KB/s
- 读延迟: _____ ns

**随机写测试 (rand-write-4k)**:
- 写 IOPS: _____ IOPS ⭐
- 写带宽: _____ KB/s
- 写延迟: _____ ns

**混合读写测试 (mixed-rw)**:
- 读 IOPS: _____ IOPS
- 读带宽: _____ KB/s
- 读延迟: _____ ns
- 写 IOPS: _____ IOPS
- 写带宽: _____ KB/s
- 写延迟: _____ ns

**延迟测试 (latency-test, QD=1)**:
- 写 IOPS: _____ IOPS
- 写带宽: _____ KB/s
- 写延迟: _____ ns ⭐

**高队列深度测试 (high-qd, QD=256)**:
- 写 IOPS: _____ IOPS
- 写带宽: _____ KB/s
- 写延迟: _____ ns

**fsync 测试**:
- IOPS: _____ IOPS
- 带宽: _____ KB/s
- 平均延迟: _____ ns

**测试命令参考**:
```bash
# 运行测试脚本
cd /home/ubuntu/e2b-testing-scripts
sudo ./04_host_performance.py --fio

# 查看测试结果
cat /tmp/fio_results/summary_report.txt
```

**示例数据** (供参考):
```
seq-read: 读 IOPS: 972.02, 读带宽: 995343 KB/s, 读延迟: 32919457.67 ns
seq-write: 写 IOPS: 972.38, 写带宽: 995719 KB/s, 写延迟: 32907383.90 ns
rand-read-4k: 读 IOPS: 16007.00, 读带宽: 64027 KB/s, 读延迟: 3997936.72 ns
rand-write-4k: 写 IOPS: 16204.57, 写带宽: 64818 KB/s, 写延迟: 3949263.70 ns
mixed-rw: 读 IOPS: 11225.85, 写 IOPS: 4815.03
latency-test: 写 IOPS: 4935.23, 延迟: 202370.66 ns
high-qd: 写 IOPS: 16306.68, 延迟: 15698690.65 ns
fsync-test: IOPS: 2133.51, 延迟: 1428.68 ns
```

**性能基准对比 (AWS EBS)**:
- gp2 (3000-16000 IOPS): 4K 随机写 IOPS: 3000-16000, 延迟: 1-3 ms
- gp3 (3000 基准, 最高 16000): 4K 随机写 IOPS: 3000-16000, 延迟: 1-3 ms
- io2 (最高 256000 IOPS): 4K 随机写 IOPS: 可配置, 延迟: < 1 ms
- 本地 NVMe SSD: 4K 随机写 IOPS: 100000+, 延迟: < 0.1 ms

---

### 5.4 网络I/O性能

#### 宿主机内网带宽测试

**iperf3测试**:
- **内网带宽**: _____ Gbps

---

#### 宿主机公网带宽测试

**speedtest测试**:
- 公网下载带宽: _____ Mbps
- 公网上传带宽: _____ Mbps

---

#### 宿主机到云存储延迟测试 ⭐

**ping或HTTP请求测试**:
- **到GCS/S3延迟**: _____ ms ⭐

---

#### 宿主机网络PPS测试

**pktgen或iperf3测试**:
- **网络PPS**: _____ PPS

---

## 六、云存储集成性能指标测试

### 6.1 对象存储上传性能

#### 小文件上传速度测试 (1MB)

| 测试次数 | 上传速度(MB/s) | 备注 |
|---------|--------------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均速度**: _____ MB/s

---

#### 大文件上传速度测试 (1GB)

| 测试次数 | 上传速度(MB/s) | 备注 |
|---------|--------------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均速度**: _____ MB/s

---

#### 并行上传吞吐量测试

**同时上传10个100MB文件**:
- 总数据量: 1000 MB
- 总耗时: _____ 秒
- **并行吞吐量**: _____ MB/s

---

### 6.2 对象存储下载性能

#### 小文件下载速度测试 (1MB)

| 测试次数 | 下载速度(MB/s) | 备注 |
|---------|--------------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均速度**: _____ MB/s

---

#### 大文件下载速度测试 (1GB)

| 测试次数 | 下载速度(MB/s) | 备注 |
|---------|--------------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均速度**: _____ MB/s

---

#### 并行下载吞吐量测试

**同时下载10个100MB文件**:
- 总数据量: 1000 MB
- 总耗时: _____ 秒
- **并行吞吐量**: _____ MB/s

---

### 6.3 对象存储操作延迟

#### 对象列举延迟测试

| 测试次数 | 延迟(ms) | 对象数量 | 备注 |
|---------|---------|---------|------|
| 1 | | | |
| 2 | | | |
| 3 | | | |

**平均延迟**: _____ ms

---

#### 对象元数据读取延迟测试

| 测试次数 | 延迟(ms) | 备注 |
|---------|---------|------|
| 1 | | |
| 2 | | |
| 3 | | |

**平均延迟**: _____ ms

---

## 七、综合成本指标

### 7.1 基础设施成本

#### 实例计算成本

- **实例小时价格**: $_____ /小时
- **定价模式**: □ 按需  □ 1年预留  □ 3年预留  □ 竞价
- **月度计算成本**: $_____ /月 (730小时)

---

#### 存储成本细分

- **本地磁盘容量**: _____ GB
- **本地磁盘单价**: $_____ /GB/月
- **本地磁盘成本**: $_____ /月

- **模板总大小**: _____ GB
- **模板存储单价**: $_____ /GB/月
- **模板存储成本**: $_____ /月

- **快照总大小**: _____ GB
- **快照存储单价**: $_____ /GB/月
- **快照存储成本**: $_____ /月

- **总存储成本**: $_____ /月

---

### 7.2 单位成本指标

#### 每沙箱小时成本

- 实例小时成本: $_____ /小时
- 存储小时成本: $_____ /小时
- 网络小时成本: $_____ /小时
- 平均并发沙箱数: _____ 个
- **每沙箱小时成本**: $_____ /沙箱/小时

---

#### 单位算力成本 ⭐

- 实例月度成本: $_____ /月
- CPU多核性能分数: _____ events/s
- **单位算力成本**: $_____ /分 ⭐ (越低越好)

---

## 测试完成检查清单

- [ ] 沙箱生命周期指标测试完成
- [ ] 模板管理指标测试完成
- [ ] 快照机制指标测试完成
- [ ] 沙箱内部性能指标测试完成
- [ ] 宿主机性能指标测试完成
- [ ] 云存储集成性能指标测试完成
- [ ] 综合成本指标计算完成
- [ ] 所有核心指标(⭐标记)已记录
- [ ] 数据已录入汇总对比表

---

**测试备注**:

_______________________________________________

_______________________________________________

_______________________________________________

**测试完成日期**: ___________  
**审核人**: ___________
